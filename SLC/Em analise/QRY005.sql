SELECT LTRIM(RTRIM(E1_FILIAL)) AS FILIAL,
LTRIM(RTRIM(E1_PREFIXO)) AS PREFIXO,
LTRIM(RTRIM(E1_NUM)) AS NUMEROTITULO,
LTRIM(RTRIM(E1_PARCELA)) AS PARCELA,
LTRIM(RTRIM(E1_TIPO)) AS TIPO,
LTRIM(RTRIM(E1_NUMBCO)) AS NOSSONUMERO,LTRIM(RTRIM(E1_NATUREZ)) AS NATUREZA,REPLACE(CONVERT(DECIMAL(15,2),E1_VALOR),'.',',') AS VALOR,
LTRIM(RTRIM(REPLACE(CONVERT(DECIMAL(15,2),E1_VALOR - ( COALESCE((SELECT SUM(E5_VALOR) FROM SE5010 WHERE  SE5010.E5_FILIAL = SE1010.E1_FILIAL 
AND SE5010.E5_NUMERO = SE1010.E1_NUM AND SE5010.E5_PARCELA = SE1010.E1_PARCELA AND SE5010.E5_CLIENTE = SE1010.E1_CLIENTE AND SE5010.E5_TIPO = 
SE1010.E1_TIPO AND SE5010.E5_LOJA = SE1010.E1_LOJA AND SE5010.E5_PREFIXO = SE1010.E1_PREFIXO AND SE5010.E5_TIPODOC IN ('CP','VL') AND SE5010.D_E_L_E_T_ = ' '),0) -  
COALESCE((SELECT SUM(FK1_VALOR) FROM FK1010 , FK7010 WHERE  FK1_IDDOC = FK7_IDDOC AND FK7_CLIFOR = SE1010.E1_CLIENTE AND FK7_FILIAL = SE1010.E1_FILIAL AND FK7_LOJA = 
SE1010.E1_LOJA AND FK7_PARCEL = SE1010.E1_PARCELA AND FK7_TIPO = SE1010.E1_TIPO AND FK7_NUM = SE1010.E1_NUM AND FK7_PREFIX = SE1010.E1_PREFIXO AND FK1_TPDOC = 'ES' 
AND FK1010.D_E_L_E_T_ = ' ' AND FK7010.D_E_L_E_T_ = ' '),0)) + ( COALESCE((SELECT SUM(FKD_VALOR) FROM FK7010 , FKD010 
WHERE  FK7_CLIFOR = SE1010.E1_CLIENTE AND FK7_FILIAL = SE1010.E1_FILIAL AND FK7_LOJA = SE1010.E1_LOJA AND FK7_PARCEL = SE1010.E1_PARCELA AND FK7_TIPO = SE1010.E1_TIPO AND FK7_NUM = SE1010.E1_NUM AND FK7_PREFIX = SE1010.E1_PREFIXO AND FKD_FILIAL = FK7_FILIAL AND FKD_IDDOC = FK7_IDDOC AND FKD_CODIGO IN ('000004','000006') AND FK7010.D_E_L_E_T_ = ' ' AND FKD010.D_E_L_E_T_ = ' '),0) -  COALESCE((SELECT SUM(FKD_VALOR) FROM FK7010 , FKD010 WHERE  FK7_CLIFOR = SE1010.E1_CLIENTE AND FK7_FILIAL = SE1010.E1_FILIAL AND FK7_LOJA = SE1010.E1_LOJA AND FK7_PARCEL = SE1010.E1_PARCELA AND FK7_TIPO = SE1010.E1_TIPO AND FK7_NUM = SE1010.E1_NUM AND FK7_PREFIX = SE1010.E1_PREFIXO AND FKD_FILIAL = FK7_FILIAL AND FKD_IDDOC = FK7_IDDOC AND FKD_CODIGO IN ('000008') AND FK7010.D_E_L_E_T_ = ' ' AND FKD010.D_E_L_E_T_ = ' '),0))),'.',','))) AS SALDO,LTRIM(RTRIM(A1_COD)) AS CODCLI,LTRIM(RTRIM(A1_LOJA)) AS LOJCLI,LTRIM(RTRIM(A1_NOME)) AS DEVEDOR,LTRIM(RTRIM(A1_CGC)) AS CPFCNPJ,LTRIM(RTRIM(A1_DDD + A1_TEL)) AS TELEFONE,LTRIM(RTRIM(A1_EMAIL)) AS EMAIL,LTRIM(RTRIM(A1_END)) AS ENDERECO,LTRIM(RTRIM(A1_BAIRRO)) AS BAIRRO,LTRIM(RTRIM(A1_MUN)) AS MUNICIPIO,LTRIM(RTRIM(A1_CEP)) AS CEP,LTRIM(RTRIM(A1_EST)) AS ESTADO,LTRIM(RTRIM(CONVERT(VARCHAR,CONVERT(DATE,E1_EMISSAO),103))) AS EMISSAO,LTRIM(RTRIM(CONVERT(VARCHAR,CONVERT(DATE,E1_VENCTO),103))) AS VENCIMENTO,LTRIM(RTRIM(E1_TIPO)) AS ESPECIE,LTRIM(RTRIM((CASE WHEN CC2_XCOMAR = ' ' THEN A1_MUN ELSE CC2_XCOMAR END))) AS COMARCA,'D' AS DECLARACAO,'M' AS ENDOSSO,LTRIM(RTRIM(FRV010.FRV_DESCRI)) AS SITUACAO,LTRIM(RTRIM(SE1010.E1_HIST)) AS HISTORICO,(CASE WHEN SE1010.E1_VENCTO < GETDATE() THEN 'TITULO VENCIDO' ELSE 'A VENCER' END) AS STATUS_TITULO,LTRIM(RTRIM(E1_FORCOB)) AS EMP_COBRANCA,COALESCE((SELECT SA2010.A2_NOME FROM SA2010 WHERE  SA2010.A2_COD = SE1010.E1_FORCOB),'-') AS EMPRESA_COBRANCA FROM SE1010 , SA1010 , CC2010 , FRV010 WHERE  SE1010.E1_SALDO > 0 AND SA1010.A1_COD = SE1010.E1_CLIENTE AND SE1010.E1_FILIAL BETWEEN '01    ' AND '33    ' AND SE1010.E1_TIPO !=' ' AND SE1010.E1_TIPO !=' ' AND SE1010.E1_LOJA = SA1010.A1_LOJA AND CC2010.CC2_CODMUN = SA1010.A1_COD_MUN AND CC2010.CC2_EST = SA1010.A1_EST AND FRV010.FRV_CODIGO = SE1010.E1_SITUACA AND CC2010.D_E_L_E_T_ = ' ' AND SA1010.D_E_L_E_T_ = ' ' AND SE1010.D_E_L_E_T_ = ' '  ORDER BY  A1_CGC, E1_VENCTO ASC
